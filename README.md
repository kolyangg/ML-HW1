# ML-HW1
ML HW1 including FastAPI realisation

В данном проекте мы обучили модель регрессии для предсказания стоимости автомобилей, а также реализовали веб-сервис для применения построенной модели на новых данных (на базе FastAPI).

Основные результаты:

Часть 1 (EDA):
- Посмотрели исходные данные, посчитали основные статистики
- Нашли пропуски в данных, в колонках ['mileage', 'engine', 'max_power', 'torque', 'seats']
- Удалили повторяющиеся строки
- Поправили столбцы  mileage, engine, max_power и torque (разбили на torque и max_torque_rom), сделали значения в них числовыми
- Заполнили пропуски в столбцах медианами
- Преобразовали соответствующие числовые типы к int (engine, seats)
- Сделали визуализации и обнаружили, что:
      наибольшие значения selling_price достигаются при низком km_driven, высоком year и высоком max_power
      engine и max_power существенно и положительно коррелируют, engine и mileage отрицательно коррелируют
      test и train в целом похожи, но есть некоторые различия - в train есть более дорогие автомобили, которых нету в test; в train есть аутлайеры с особо большими значениями  
      (max torque_rpm, max_power, seats итд), которых нету в test
      исходя из распределения Selling_price, в выборке больше относительно дешёвых автомобилей, чем было бы при нормальном распределении
- Видим значительное количество выбросов в Selling_price, mileage, engine - возможно они есть и в других признаках

Часть 2 (ML вещественные признаки):
- Построили модель сначала на вещественных признаках
- Добавили L1 регуряризацию (при alpha = 20000 занулились mileage, engine и seats), подобрали оптимальные параметры для ElasticNet регрессии
- r2_score: 0.578

Часть 3 (ML вещественные + категориальные фичи):
- Закодировали категориальные фичи с помощью OHE
- Построили ridge регрессию, нашли лучший параметр регуляризации alpha через GridSearchCV
- Получили существенный рост r2_score до 0.658

Часть 4 (Feature Engineering):
- Попробовали разные новые фичи:
   1) применили годы в квадратах
   2) сделали марку автомобиля (первое слово в name) категориальным признаком и применили OHE
   3) сделали марку + модель автомобиля (первые два слова в name) категориальным признаком и применили OHE
   4) добавили новые признаков 'third_owner_above' (3 и более владельцев) и 'one-two_owner_and_official' (1-2 владельца и офиц. продавец)
   5) привели количество владельцев к вещественному признаку не помогает
 
- 2 и 3) дали максимальный буст в качестве модели (до r2_score: 0.729 и 0.758, соответвственно) - 3) существеннее, его и выбрали из двух
- логично, разные модели автомобилей (марка + модель) имеют довольно разные цены
- итоговая модель имеет r2_score: 0.758

Часть 4.2 Бизнесовая
- наша модель имеет долю предиктов, отличающихся от реальных цен на эти авто не более чем на 10% (в одну или другую сторону) в 60.9%

Часть 5 Сервис на FastAPI
- реализовали сервис в отдельных файлах (fastapi_part.py, который берёт функции из utils.py)
- используются pickle файлы с натренированным scaler для вещественых фичей (scaler.pkl) и OHE для категориальных фичей (ohe.pkl и ohe_name.pkl)
- используются веса натренированной модели (trained_model.pkl)
- сервис работает:
   1) Отправляет предсказанную стоимость машины в ответс на признаки одного объекта в формате json. Ответ совпадает с результатом в модели в jupiter-ноутбуке
   2) Отправляет csv-файл с исходными данными и +1 столбцом с предсказаниями стоимости в ответ на csv-файл с признаками тестовых объектов. Ответ совпадает с результатом в 
      модели в jupiter-ноутбуке

Что можно улучшить в дальнейшем:
- исключить аутлайеры в признаках (например, engine, mileage - исходя из boxplot графиков) и таргете (selling_price)
- некоторые признаки распределены не совсем нормально, можем их  отлогарифмировать
- устранить мультиколлинеарность через исключение коррелированных столбцов
- в столбце mileage есть данные в разных единицах, мы брали просто числа; можем привести всё к одинаковым единицам
- удалить наименее помогающие нам переменные

Скриншот из Postman для предикта на одном объекте:
<img width="471" alt="predict_item examle" src="https://github.com/kolyangg/ML-HW1/assets/63516227/3989ceaa-97a6-4db6-887e-e1dbd7a5cecf">

Скриншот из Postman для предикта на csv-файле:
<img width="473" alt="predict_items examle" src="https://github.com/kolyangg/ML-HW1/assets/63516227/bd1045a5-6bdf-4ca0-aeb4-b12cdaf9978b">
